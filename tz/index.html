<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>采购管理部物料查询系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col">
  <!-- 顶部标题栏 -->
  <header class="bg-blue-600 text-white py-5 text-center text-2xl font-bold shadow-md">
    采购管理部物料查询系统
  </header>

  <main class="flex-grow max-w-5xl mx-auto mt-8 bg-white rounded-2xl shadow-md p-8 fade-in">
    <!-- 信息提示栏 -->
    <p class="text-center text-sm text-gray-600 bg-gray-100 py-3 px-4 rounded-lg mb-6 border border-gray-200">
      | 数据来源：采购部 | 查询范围：包材及原料信息（2022年1月1日 - 2025年10月14日） | 保密声明：请注意，所有数据均属内部信息，严禁泄露。 |
    </p>

    <!-- 查询区 -->
    <div class="flex flex-wrap gap-3 mb-5">
      <select id="year" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
        <option value="">全部年份</option>
        <option value="2025">2025</option>
        <option value="2024">2024</option>
        <option value="2023">2023</option>
        <option value="2022">2022</option>
      </select>

      <input type="text" id="supplier" placeholder="供应商名称（可简称）" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
      <input type="text" id="projectNo" placeholder="项目号（需精准）" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
      <input type="text" id="projectName" placeholder="项目名称（可简称）" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-400 focus:border-blue-400">

      <button onclick="searchData()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg text-sm font-medium transition">查询</button>
      <button onclick="resetForm()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-5 py-2 rounded-lg text-sm font-medium transition">重置</button>
    </div>

    <!-- 结果展示 -->
    <div id="result" class="overflow-x-auto mt-4"></div>
  </main>

  <!-- 页脚 -->
  <footer class="text-center text-gray-500 text-sm my-6">
    © 2025 德令哈采购部 | 内部数据查询系统
  </footer>

  <script>
    let dataCache = [];

    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        dataCache = data;
        console.log("✅ 数据已加载:", dataCache.length, "条");
      })
      .catch(err => {
        console.error("❌ 数据加载失败:", err);
        alert("无法读取数据文件，请确认路径 data.json 是否正确。");
      });

    function searchData() {
      const year = document.getElementById("year").value.trim();
      const supplier = document.getElementById("supplier").value.trim();
      const projectNo = document.getElementById("projectNo").value.trim();
      const projectName = document.getElementById("projectName").value.trim();

      if (!year && !supplier && !projectNo && !projectName) {
        alert("请输入至少一项查询条件！");
        return;
      }

      let filtered = dataCache.filter(item => {
        const supplierStr = item["供应商名称"] || "";
        const projectNoStr = item["项目号"] || "";
        const projectNameStr = item["项目名称"] || "";
        const contractNoStr = item["合同编号"] || "";

        const matchYear = year ? contractNoStr.includes(year) : true;
        const matchSupplier = supplier ? supplierStr.includes(supplier) : true;
        const matchProjectNo = projectNo ? projectNoStr.includes(projectNo) : true;
        const matchProjectName = projectName ? projectNameStr.includes(projectName) : true;

        return matchYear && matchSupplier && matchProjectNo && matchProjectName;
      });

      filtered.sort((a, b) => {
        const aNum = Number(a["合同编号"]?.match(/\d+/g)?.join('') || 0);
        const bNum = Number(b["合同编号"]?.match(/\d+/g)?.join('') || 0);
        return bNum - aNum;
      });

      if (filtered.length === 0) {
        document.getElementById("result").innerHTML = `<p class="text-center text-gray-500 py-4">未找到匹配的数据。</p>`;
        return;
      }

      let total = filtered.reduce((sum, item) => sum + Number(item["订单总额"] || 0), 0);

      let tableHTML = `
        <table class="w-full border border-gray-200 text-sm text-center rounded-lg overflow-hidden shadow-sm fade-in">
          <thead class="bg-blue-50 text-gray-700">
            <tr>
              <th class="border p-2">项目号</th>
              <th class="border p-2">项目名称</th>
              <th class="border p-2">数量</th>
              <th class="border p-2">单位</th>
              <th class="border p-2">采购单价</th>
              <th class="border p-2">订单总额</th>
              <th class="border p-2">供应商名称</th>
              <th class="border p-2">合同编号</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            ${filtered.map(row => `
              <tr class="hover:bg-blue-50 transition">
                <td class="border p-2">${row["项目号"] || ""}</td>
                <td class="border p-2">${row["项目名称"] || ""}</td>
                <td class="border p-2">${row["数量"] || ""}</td>
                <td class="border p-2">${row["单位"] || ""}</td>
                <td class="border p-2">${row["采购单价"] || ""}</td>
                <td class="border p-2">${row["订单总额"] || ""}</td>
                <td class="border p-2">${row["供应商名称"] || ""}</td>
                <td class="border p-2">${row["合同编号"] || ""}</td>
              </tr>
            `).join('')}
          </tbody>
          <tfoot class="bg-gray-100 font-semibold">
            <tr><td colspan="6" class="p-2 text-right">金额总计：</td><td colspan="2" class="p-2 text-blue-700">${total.toFixed(2)}</td></tr>
          </tfoot>
        </table>
      `;

      document.getElementById("result").innerHTML = tableHTML;
    }

    function resetForm() {
      document.getElementById("year").value = "";
      document.getElementById("supplier").value = "";
      document.getElementById("projectNo").value = "";
      document.getElementById("projectName").value = "";
      document.getElementById("result").innerHTML = "";
    }
  </script>
</body>
</html>
