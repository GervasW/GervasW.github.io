<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç‰©æ–™æŸ¥è¯¢ç³»ç»Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold text-gray-800 mb-6">ç‰©æ–™æŸ¥è¯¢ç³»ç»Ÿ</h1>

  <!-- æŸ¥è¯¢è¾“å…¥åŒº -->
  <div class="w-full max-w-4xl bg-white p-6 rounded-2xl shadow mb-8">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <input id="supplier" type="text" placeholder="ä¾›åº”å•†åç§°" class="border p-2 rounded w-full" />
      <input id="projectId" type="text" placeholder="é¡¹ç›®å·" class="border p-2 rounded w-full" />
      <input id="projectName" type="text" placeholder="é¡¹ç›®åç§°" class="border p-2 rounded w-full" />
      <button id="searchBtn" class="bg-blue-600 text-white rounded p-2 hover:bg-blue-700">æŸ¥è¯¢</button>
    </div>
  </div>

  <!-- æŸ¥è¯¢ç»“æœè¡¨æ ¼ -->
  <div class="w-full max-w-6xl bg-white p-6 rounded-2xl shadow">
    <table class="min-w-full border border-gray-300 text-sm text-gray-700">
      <thead class="bg-gray-100">
        <tr>
          <th class="border px-3 py-2">åˆåŒç¼–å·</th>
          <th class="border px-3 py-2">ä¾›åº”å•†åç§°</th>
          <th class="border px-3 py-2">é¡¹ç›®å·</th>
          <th class="border px-3 py-2">é¡¹ç›®åç§°</th>
          <th class="border px-3 py-2">æ•°é‡</th>
          <th class="border px-3 py-2">å•ä½</th>
          <th class="border px-3 py-2">é‡‡è´­å•ä»·</th>
          <th class="border px-3 py-2">è®¢å•æ€»é¢</th>
        </tr>
      </thead>
      <tbody id="resultTable">
        <tr><td colspan="8" class="text-center text-gray-400 py-4">è¯·è¾“å…¥æŸ¥è¯¢æ¡ä»¶åç‚¹å‡»æŸ¥è¯¢</td></tr>
      </tbody>
    </table>

    <!-- é‡‘é¢æ€»è®¡ -->
    <div id="totalAmount" class="text-right text-lg font-semibold text-gray-800 mt-4"></div>
  </div>

  <!-- é¡µè„š -->
  <footer class="mt-10 text-gray-500 text-sm">
    Â© 2025 ç”±ç‹ç»´è®¾è®¡ï¼Œåªèƒ½æŸ¥è¯¢åŒ…æå’ŒåŸæ–™ã€‚
  </footer>

  <script>
    async function loadData() {
      try {
        const url = 'data.json?t=' + Date.now();
        console.log("å°è¯•åŠ è½½æ•°æ®æ–‡ä»¶ï¼š", url);
        const response = await fetch(url);
        if (!response.ok) throw new Error("HTTPçŠ¶æ€ " + response.status);
        const json = await response.json();
        console.log("âœ… æˆåŠŸè¯»å– JSON æ•°æ®ï¼Œå…±", json.length, "æ¡è®°å½•");
        return json;
      } catch (err) {
        console.error("âŒ åŠ è½½ data.json å¤±è´¥ï¼š", err);
        alert("æ— æ³•è¯»å–æ•°æ®æ–‡ä»¶ï¼Œè¯·ç¡®è®¤è·¯å¾„æ­£ç¡®ï¼ˆtz/data.jsonï¼‰å¹¶å·²åœ¨ GitHub Pages å‘å¸ƒã€‚");
        return [];
      }
    }

    async function searchData() {
      const supplier = document.getElementById('supplier').value.trim();
      const projectId = document.getElementById('projectId').value.trim();
      const projectName = document.getElementById('projectName').value.trim();

      console.log("ğŸ” æœç´¢æ¡ä»¶ï¼š", { supplier, projectId, projectName });

      const data = await loadData();
      const resultTable = document.getElementById('resultTable');
      const totalAmountEl = document.getElementById('totalAmount');

      const filtered = data.filter(item => {
        const supplierMatch = supplier === "" || item.ä¾›åº”å•†åç§°.includes(supplier);
        const projectIdMatch = projectId === "" || item.é¡¹ç›®å·.includes(projectId);
        const projectNameMatch = projectName === "" || item.é¡¹ç›®åç§°.includes(projectName);
        return supplierMatch && projectIdMatch && projectNameMatch;
      });

      resultTable.innerHTML = "";
      totalAmountEl.textContent = "";

      if (filtered.length === 0) {
        resultTable.innerHTML = `<tr><td colspan="8" class="text-center text-gray-400 py-4">æœªæ‰¾åˆ°åŒ¹é…çš„è®°å½•</td></tr>`;
        return;
      }

      let total = 0;
      filtered.forEach(row => {
        total += parseFloat(row.è®¢å•æ€»é¢);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="border px-3 py-2">${row.åˆåŒç¼–å·}</td>
          <td class="border px-3 py-2">${row.ä¾›åº”å•†åç§°}</td>
          <td class="border px-3 py-2">${row.é¡¹ç›®å·}</td>
          <td class="border px-3 py-2">${row.é¡¹ç›®åç§°}</td>
          <td class="border px-3 py-2 text-right">${row.æ•°é‡}</td>
          <td class="border px-3 py-2">${row.å•ä½}</td>
          <td class="border px-3 py-2 text-right">${row.é‡‡è´­å•ä»·}</td>
          <td class="border px-3 py-2 text-right">${row.è®¢å•æ€»é¢}</td>
        `;
        resultTable.appendChild(tr);
      });

      totalAmountEl.textContent = "ğŸ’° é‡‘é¢æ€»è®¡ï¼š" + total.toLocaleString() + " å…ƒ";
    }

    document.getElementById('searchBtn').addEventListener('click', searchData);
    document.addEventListener('keydown', e => { if (e.key === 'Enter') searchData(); });
  </script>
</body>
</html>
